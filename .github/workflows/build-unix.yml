name: test-highs

on: ["push", "pull_request"]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: DEBUG
  MAKEFLAGS: -j
  CTEST_PARALLEL_LEVEL: 8

  # First test current default build. (master) (still 1.0.0)
  HIGHS_VERSION: 1.0.0

jobs:
  build_highs:

    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]

    steps:
    - uses: actions/checkout@v2

    - name: Install dependencies
      uses: actions/cache@v1
      with:
        path: ./Dependencies
        key: dependencies-${{env.HIGHS_VERSION}}-${{ matrix.os }}

    - name: Clone HiGHS
      if: steps.cached-dependencies.outputs.cache-hit != 'true'
      run: |
        cd $HOME
        git clone https://www.github.com/ERGO-Code/HiGHS.git
        cmake -E make_directory ./HiGHS/build
        cd ./HiGHS/build
        ls

    - name: Build HiGHS release and debug
      shell: bash
      run: |
        cd $HOME/HiGHS/build
        ls 
        pwd
        cmake ..
        cmake --build .
      # cmake --build . --config DEBUG

    - name: Test
      working-directory: $HOME/HiGHS/build
      shell: bash
      # Execute tests defined by the CMake configuration.  
      # See https://cmake.org/cmake/help/latest/manual/ctest.1.html for more detail
      run: |
        ctest